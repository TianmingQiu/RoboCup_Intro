\chapter{Implementation}\label{Chap:Imp}
With a working NAO without obvious calibration problems, the new behaviors are designed and implemented so that our team can beat against the other team. This Chapter describes how we define the new behavior based on the existing code framework. The behavior is not written using standard C, but using the CABSL (C-based Agent Behavior Specification Language), developed by the B-Human team as in \cite{BHumanCodeRelease2013}(cf. 5.1).
\clearpage
\section{Roles in SPL and at TUM}
As describe in \cite{Rules}, in the RoboCup Standard Platform League (SPL), there could be no more than 5 players in each team. One is goal keeper and the others are all field players. As shown in \fref{fig: SPL}, they could be defender, supporter and striker. The corresponding region where these roles are responsible can be roughly separated with the red rectangles in the graph. Goalkeeper and defender works for defending the goal. Strikers and supporters are responsible for scoring.
\begin{figure}[!htb]
    \includegraphics[width=0.9\textwidth]{pics/SPL}
    \centering
    \caption{Roles in SPL}
    \label{fig: SPL}
\end{figure}\\
For the RoboCup at TUM, there are three robots in each team, namely the goal-keeper, defender and striker as shown in \fref{fig: TUM}. The original behavior of these roles are from B-Human CodeRelease in \cite{BHumanCodeRelease2015}.
\begin{figure}[!htb]
    \centering
    \includegraphics[width=\textwidth]{pics/TUM}
    \caption{Roles at TUM}
    \label{fig: TUM}
\end{figure}

\section{Defender}
\subsection{Defender Behavior}
As shown in the field in \fref{fig: DeFloCha}, defender will always start from one side of the field. Then he will walk to the defense area, face the opponent direction and defend in that area. If the ball is near it in some range, namely smaller than some threshold, he will walk to ball, align to the goal, align behind the ball and kick it out of that region. Then he will go back to the state defend. As a result, the defender will defend in the defense area most of his time as shown in the flow-chart in \fref{fig: DeFloCha}. The original defense area is shown with red rectangle in the left of \fref{fig: DeFloCha}.
\begin{figure}[!htb]
  \centering
  \includegraphics[width=0.8\textwidth]{pics/St_DA}
  \caption{Defender: static defense area and flow chart }
  \label{fig: DeFloCha}
\end{figure}

\subsection{Problems in Defender}
As there are only 3 robots in each team, there is no supporter. The region between the defense area and the center is empty, where is dangerous as no one can stop the opponent striker.

\subsection{Proposed Solution for Defender}
To tactile this problem, a method called ``dynamic defense area'' is proposed as shown in \fref{fig: DefFix}.
\begin{figure}[!htb]
  \centering
  % \includegraphics[scale=0.4]{pics/Dy_DA}
  % \qquad
  % \includegraphics[scale=0.7]{pics/Imp_Def}
  \includegraphics[width=\textwidth]{pics/Dy_DA}
  \caption{Defender: dynamic defense area and flow chart }
  \label{fig: DefFix}
\end{figure}\\
As shown in the flow-chart, the first procedure is the same as before: robots start from one side of the field and go to the defense area to defend there. If ball is near it, it will go and kick it out of that region. What we proposed is another condition, which is highlighted in the flow-chart with red lines: if the ball is far away to the defender, i.e. bigger than some threshold, defender will go to defend in some new region near the center of the field. So the defense area is enlarged until the center of the field. If the ball is suddenly behind the defender, the defender will come back to the original defense area like before. In summary, the defense area is dynamic as it will change according to the distance of the ball and the defender.\\
There are mainly two benefits of the proposed method:
\begin{itemize}
    \item enlarged defense area
    \item compensation for the lack of supporters
\end{itemize}
Even if there are more robots given in the future courses, this behavior can still be kept as the region where the supporters take care is somewhere around the striker, so that they can focusing on supporting on strikers and do not care too much on the field before the center of the field. This can help the team to score more efficiently. The demonstration video for the ``dynamic defense area'' can be found at \url{https://youtu.be/XNjRpqoJ18c}.
\clearpage
\section{Striker}\label{sec:Striker}
\subsection{Striker behavior}
As shown in the flow-chart in \fref{fig: StaStrik}, the striker will always  search for ball, align behind it and kick it in the direction of the center of opponent goal. The direction of the kicking is like the arrow shown in the left part of \fref{fig: StaStrik}.
\begin{figure}[!htb]
  \centering
  % \includegraphics[scale=0.3]{pics/St_Striker}
  % \qquad \qquad \qquad
  \includegraphics[width=0.7\textwidth]{pics/St_Striker}
  \caption{Striker: static kicking direction and flow chart }
  \label{fig: StaStrik}
\end{figure}

\subsection{Problems in Striker}
The behavior of goal-keeper is to put himself between the ball and the center of the goal. So if the direction of the score kicking is like the arrow shown in \fref{fig: StaStrik}, the ball will stopped by the body of Goalkeeper with high possibility. This is disadvantageous for the team to score the opponent.

\subsection{Proposed Solution for Striker}
To increase the possibility of the scoring kick, a method called ``dynamic kicking direction'' is proposed. The main idea is shown in \fref{fig: DyStrik}.
\begin{figure}[!htb]
  \centering
  \includegraphics[width=\textwidth]{pics/Dy_Striker}
  % \qquad \qquad
  % \includegraphics[scale=0.7]{pics/Imp_Stri}
  \caption{Striker: dynamic kicking direction and flow chart }
  \label{fig: DyStrik}
\end{figure}\\
The main behavior is identical to the previous. The striker will keep detecting the distance between itself and the center of the opponent goal. If they are near with each other to some threshold, the kicking direction will be changed to the far goal post, rather than the center of the goal, like the arrow direction shown in \fref{fig: DyStrik}.\\
With the proposed method, the striker can score the opponent with higher possibility. The demonstration video for ``dynamic kicking direction'' can be found at \url{https://youtu.be/VrZ4jPr-9Os}.
